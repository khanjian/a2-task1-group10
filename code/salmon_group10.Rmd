---
title: "Task 1"
author: "Roupen Khanjian, Genevieve Chiong, Katelin Seeto"
date: "2/1/2021"
output:
   html_document:
     theme: darkly
     code_folding: hide
     toc: true
     toc_float: true
     number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(tsibble)
library(feasts)
library(lubridate)
library(knitr)
```

```{r}
# Read in the data
fish <- read_csv(here("data", "willamette_fish_passage.csv"))
```

```{r}
# Wrangle the data
fish_ts <- fish %>% 
  clean_names() %>% 
  mutate(date = lubridate::mdy(date)) %>% # Convert to date 
  select(date, coho, jack_coho, steelhead) %>% # Select only for date and fish of interest
  replace_na(list(coho = 0, jack_coho = 0, steelhead = 0)) %>%
  pivot_longer(c(coho:steelhead),
               names_to = "species", 
               values_to = "count") %>% # Replace NA values with 0 
  as_tsibble(key = species, index = date) # Convert to tsibble 
```


# Overview {.tabset}

```{r echo=FALSE, out.width= '100%', out.height= '100%', fig.cap= "Salmon swim past Oregon Department of Fish and Wildlife's (ODFW) counting window at the Willamette Falls fishway. Photograph Credit: Eric Ollerenshaw, ODFW"}

knitr::include_graphics(here("images", "fish_count_window.png"))
```
This report details adult fish passage for Coho, Jack Coho, and Steelhead salmon at the Willamette Falls fish ladder on the Willamette River in Oregon from 2001-01-01 to 2010-12-31. Note that the Willamette Falls fish ladder was not operational on the following dates:  

* 2005-11-29 to 2005-12-01, 2005-12-06 to 2005-12-08, 2005-12-13 to 2005-12-14  
* 2008-08-26 to 2008-09-21  
* 2010-08-23 to 2010-08-27  

Included is a time series of adult salmon passage, seasonplots of passage, and annual totals  of passage for each species.




The data used in this report can be accessed from  [Columbia River DART (Data Access in Real Time)](http://www.cbr.washington.edu/dart/query/adult_graph_text).  Columbia River DART is a data resource compiling information relating to the Columbia Basin salmon populations and environmental river conditions from federal, state, and tribal databases.

## Original time series 

## Seasonplots

```{r}
fish_month <- fish_ts %>% 
  group_by_key() %>% 
  index_by(yr_mo = ~yearmonth(.)) %>% # index by month to make seasonality clearer
  summarise(monthly_mean_count = mean(count, na.rm = TRUE)) %>% 
  mutate(species = recode(species, 
                          coho = "Coho",
                          jack_coho = "Jack Coho",
                          steelhead = "Steelhead"))

fish_month %>% 
  gg_season(y = monthly_mean_count)+
  labs(x = "Month",
       y = "Mean monthly count", 
       title = "Average monthly count of adult fish passage for Willamette fish ladder"
       )+
  theme_minimal()
             
```


## Annual counts by species 






